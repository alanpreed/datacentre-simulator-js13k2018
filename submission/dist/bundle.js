!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=e.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(t){let e,i,s,n,a=(t=t||{}).fps||60,h=0,o=1e3/a,r=1/a,c=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function l(){if(i=requestAnimationFrame(l),s=performance.now(),n=s-e,e=s,!(n>1e3)){for(kontra._tick(),h+=n;h>=o;)d.update(r),h-=o;c(),d.render()}}let d={update:t.update,render:t.render,isStopped:!0,start(){e=performance.now(),this.isStopped=!1,requestAnimationFrame(l)},stop(){this.isStopped=!0,cancelAnimationFrame(i)}};return d},function(){let t={},e={},s={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let t=0;t<26;t++)s[65+t]=(10+t).toString(36);for(i=0;i<10;i++)s[48+i]=""+i;addEventListener("keydown",function(i){let n=s[i.which];e[n]=!0,t[n]&&t[n](i)}),addEventListener("keyup",function(t){e[s[t.which]]=!1}),addEventListener("blur",function(t){e={}}),kontra.keys={bind(e,i){[].concat(e).map(function(e){t[e]=i})},unbind(e,i){[].concat(e).map(function(e){t[e]=i})},pressed:t=>!!e[t]}}(),function(){class t{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=((e,i)=>new t(e,i)),kontra.vector.prototype=t.prototype;class e{init(t,e,i,s){for(e in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[e]=t[e];if(i=t.image)this.image=i,this.width=i.width,this.height=i.height;else if(i=t.animations){for(e in i)this.animations[e]=i[e].clone(),s=s||i[e];this._ca=s,this.width=s.width,this.height=s.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(t=>(new e).init(t)),kontra.sprite.prototype=e.prototype}(),function(){let t,e=[],i=[],s={},n=[],a={},h={0:"left",1:"middle",2:"right"};function o(e){let i=t.x-Math.max(e.x,Math.min(t.x,e.x+e.width)),s=t.y-Math.max(e.y,Math.min(t.y,e.y+e.height));return i*i+s*s<t.radius*t.radius}function r(){let s,n,a=i.length?i:e;for(let e=a.length-1;e>=0;e--)if(n=(s=a[e]).collidesWithPointer?s.collidesWithPointer(t):o(s))return s}function c(t){a[h[t.button]]=!0,d(t,"onDown")}function l(t){a[h[t.button]]=!1,d(t,"onUp")}function d(e,i){if(!kontra.canvas)return;let n,a,h;-1!==e.type.indexOf("mouse")?(n=e.clientX,a=e.clientY):(n=(e.touches[0]||e.changedTouches[0]).clientX,a=(e.touches[0]||e.changedTouches[0]).clientY),t.x=n-kontra.canvas.offsetLeft,t.y=a-kontra.canvas.offsetTop,e.target===kontra.canvas&&(h=r())&&h[i]&&h[i](),s[i]&&s[i](e,h)}addEventListener("mousedown",c),addEventListener("touchstart",c),addEventListener("mouseup",l),addEventListener("touchend",l),addEventListener("blur",function(t){a={}}),addEventListener("mousemove",function(t){d(t,"onOver")}),t=kontra.pointer={x:0,y:0,radius:5,track(t){[].concat(t).map(function(t){t._r||(t._r=t.render,t.render=function(){e.push(this),this._r()},n.push(t))})},untrack(t,e){[].concat(t).map(function(t){t.render=t._r,t._r=e;let i=n.indexOf(t);-1!==i&&n.splice(i,1)})},over:t=>-1!==n.indexOf(t)&&r()===t,onDown(t){s.onDown=t},onUp(t){s.onUp=t},pressed:t=>!!a[t]},kontra._tick=function(){i.length=0,e.map(function(t){i.push(t)}),e.length=0}}()},function(t,e,i){"use strict";i.r(e);class s{constructor(t,e,i,s,n,a){this.x=t,this.y=e,this.color="#00E52D",this.width=i,this.height=s,this.packetWaitTime=n,this.timeSinceLastPacket=0,this.failed=!1,this.succeeded=!1,this.timeSpentOK=0,this.successWaitTime=a,this.gradient=["#00E52D","#02E701","#32E902","#63EC03","#95EE05","#C7F006","#F3EC07","#F5BE09","#F78F0A","#FA600C","#FC310D","#FF0F1B"]}checkCollisions(t){return t.forEach(t=>{const e=this.clamp(t.x,this.x,this.x+this.width),i=this.clamp(t.y,this.y,this.y+this.height),s=t.x-e,n=t.y-i;s*s+n*n<t.radius*t.radius&&(this.timeSinceLastPacket=0,t.lost=!0)}),0}clamp(t,e,i){return Math.max(e,Math.min(i,t))}update(){const t=Math.round((this.gradient.length-1)*(this.timeSinceLastPacket/this.packetWaitTime)),e=this.clamp(t,0,this.gradient.length-1);if(e===this.gradient.length-1){const t=30;(this.timeSinceLastPacket-this.packetWaitTime)%t<t/2?this.color="black":this.color=this.gradient[e]}else e<1?(this.timeSpentOK++,this.timeSpentOK>this.successWaitTime&&(this.succeeded=!0)):(this.timeSpentOK=0,this.succeeded=!1),this.color=this.gradient[e];this.timeSinceLastPacket>2*this.packetWaitTime&&(this.failed=!0),this.timeSinceLastPacket++}}class n{constructor(t,e,i,s,n){this.x=t,this.y=e,this.width=i,this.height=s,this.color="#E59500",this.rotation=n,this.restitution=1,this.render=function(){this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(this.rotation),this.context.fillStyle=this.color,this.context.fillRect(-this.width/2,-this.height/2,this.width,this.height),this.context.restore()}}}class a{constructor(t,e,i,s,n,a,h){this.x=t,this.y=e,this.color="#34D1BF",this.dx=i*Math.cos(s),this.dy=i*Math.sin(s),this.canvasWidth=a,this.canvasHeight=h,this.radius=n,this.lost=!1,this.stop=!1,this.render=function(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI),this.context.fillStyle=this.color,this.context.fill(),this.context.lineWidth=4,this.context.strokeStyle="rgba(36, 158, 144, 1)",this.context.stroke()}}checkBlockCollisions(t){var e,i;return t.forEach(t=>{const{x:s,y:n,dist:a}=this.calculateClosestPoint(t),h=t.width/2*Math.cos(t.rotation),o=t.width/2*Math.sin(t.rotation);let r=t.x-h,c=t.y-o,l=t.x+h,d=t.y+o;(s>Math.min(r,l)&&s<Math.max(r,l)||n>Math.min(c,d)&&n<Math.max(c,d))&&a<this.radius&&(this.bounce(t),e=s,i=n)}),{x:e,y:i}}update(){this.x<-this.radius||this.x>this.canvasWidth+this.radius||this.y<-this.radius||this.y>this.canvasHeight+this.radius?this.lost=!0:(this.x+=this.dx,this.y+=this.dy)}calculateLineEquation(t){return{a:-Math.tan(t.rotation),b:1,c:t.x*Math.tan(t.rotation)-t.y}}calculateClosestPoint(t){const{a:e,b:i,c:s}=this.calculateLineEquation(t);return{x:(i*(i*this.x-e*this.y)-e*s)/(Math.pow(e,2)+Math.pow(i,2)),y:(e*(-i*this.x+e*this.y)-i*s)/(Math.pow(e,2)+Math.pow(i,2)),dist:Math.abs(e*this.x+i*this.y+s)/Math.sqrt(Math.pow(e,2)+Math.pow(i,2))}}bounce(t){let e=this.pythagoras(this.dx,this.dy),i=Math.atan2(this.dx,this.dy),s=e*Math.sin(i+t.rotation),n=e*Math.cos(i+t.rotation);n*=-t.restitution,e=this.pythagoras(s,n),i=Math.atan2(n,s),this.dx=e*Math.cos(i+t.rotation),this.dy=e*Math.sin(i+t.rotation)}pythagoras(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}}class h{constructor(t,e,i,s){switch(this.rate=t,this.speed=s,this.canvasWidth=e,this.canvasHeight=i,this.packetWidth=4,Math.round(3*Math.random())){case 0:this.x=-this.packetWidth,this.y=this.packetWidth+Math.random()*(this.canvasHeight-2*this.packetWidth);break;case 1:this.x=this.packetWidth+Math.random()*(this.canvasWidth-2*this.packetWidth),this.y=-this.packetWidth;break;case 2:this.x=this.canvasWidth+this.packetWidth,this.y=this.packetWidth+Math.random()*(this.canvasHeight-2*this.packetWidth);break;case 3:this.x=this.packetWidth+Math.random()*(this.canvasWidth-2*this.packetWidth),this.y=this.canvasHeight+this.packetWidth}let n=Math.PI/12;this.x<this.canvasWidth/2?this.rotation=n+Math.random()*(Math.PI/2-2*n):this.rotation=Math.PI/2+n+Math.random()*(Math.PI/2-2*n),this.y>this.canvasHeight/2&&(this.rotation*=-1)}checkSpawnPacket(){return Math.random()<this.rate}generatePacket(){return new a(this.x,this.y,this.speed*(Math.random()+1),this.rotation,this.packetWidth,this.canvasWidth,this.canvasHeight)}}class o{constructor(t,e,i,s,n,a,h){this.x=t,this.y=e,this.width=i,this.height=s,this.name=h,this.isFailed=!1,this.shouldFail=n,this.failureDelay=a,this.time=0,this.shouldRenderFail=(()=>this.time%20==0),this.render=function(){this.context.strokeStyle="#272727",this.context.lineWidth=10,this.context.strokeRect(this.x,this.y,this.width,this.height),this.isFailed?this.shouldRenderFail()&&(this.context.fillStyle="red"):this.context.fillStyle="rgba(251, 86, 7, 0.5)",this.context.fillRect(this.x,this.y,this.width,this.height),this.context.font="20px Helvetica",this.context.textAlign="center",this.context.fillText(this.name,this.x+this.width/2,this.y+this.height/2)}}shouldRender(){return this.connectionDelay<=0&&!this.isInactive()}isActive(){return this.shouldFail&&!this.isFailed}update(){this.time++,this.isActive()&&(this.failureDelay--,0===this.failureDelay&&(this.isFailed=!0))}}class r{constructor(t,e,i){this.currentScreen=t,this.isIntroScreen=!1,this.isInitialScreen=!0,this.newGameState="menu",this.canRenderLogoSprite=!1,this.startTime=e,this.endTime=i,this.blocks=[new n(kontra.canvas.width/2,kontra.canvas.height/2,50,5,Math.PI/2)],this.packets=[],this.packetSpawners=[new h(.05,kontra.canvas.width,kontra.canvas.height,2),new h(.05,kontra.canvas.width,kontra.canvas.height,2)],this.packetSpawners[0].x=-this.packetSpawners[0].packetWidth,this.packetSpawners[1].x=this.packetSpawners[1].canvasWidth+this.packetSpawners[1].packetWidth,this.packetSpawners[0].y=this.packetSpawners[0].canvasHeight/3.5,this.packetSpawners[1].y=this.packetSpawners[1].canvasHeight/3.5,this.packetSpawners[0].rotation=Math.PI/8,this.packetSpawners[1].rotation=7*Math.PI/8,kontra.pointer.onDown(()=>{kontra.pointer.over({x:kontra.canvas.width/2,y:kontra.canvas.height-50,height:20,width:200}),"info"===this.currentScreen?this.newGameState="dataCenter":"failed"===this.currentScreen?this.currentScreen="main":this.currentScreen="info"});let s=new Image;s.src="assets/images/logo.png",this.logoSprite=kontra.sprite({x:kontra.canvas.width/4,y:20,width:200,image:s}),s.onload=(()=>{this.canRenderLogoSprite=!0})}update(){return"main"===this.currentScreen&&(this.packetSpawners.forEach(t=>{t.checkSpawnPacket()&&this.packets.push(t.generatePacket())}),this.packets.forEach((t,e)=>{t.update(),t.checkBlockCollisions(this.blocks),t.lost&&this.packets.splice(e,1)})),this.newGameState}render(){const t=kontra.context;if(t.fillStyle="#E5DADA",t.textAlign="center","info"===this.currentScreen){t.font="14px Helvetica",t.fillText("You work in one of Peruvian Web Services' datacentres.",kontra.canvas.width/2,20),t.fillText("The equipment is old, faulty and regularly needs manual intervention.",kontra.canvas.width/2,40),t.fillText("When a region goes down your job is to make sure packets:",kontra.canvas.width/2,70);const e=new a(kontra.canvas.width/2,85,"red",0,10);kontra.sprite(e).render(),t.fillStyle="#E5DADA",t.fillText("are delivered to connections: ",kontra.canvas.width/2,110);const i=new s(kontra.canvas.width/2-10,120,20,20,100);kontra.sprite(i).render(),t.fillStyle="#E5DADA",t.fillText("by placing patch cables: ",kontra.canvas.width/2,165);const h=new n(kontra.canvas.width/2,180,40,5,0,50);kontra.sprite(h).render(),t.fillText("before the datacentre goes offline.",kontra.canvas.width/2,205),t.fillText("Use your mouse to rotate and place patch cables,",kontra.canvas.width/2,350),t.fillText("to direct packets into connections before they time out.",kontra.canvas.width/2,370),t.font="30px Helvetica",t.fillStyle="#E5DADA",t.fillText("Start Game",kontra.canvas.width/2,kontra.canvas.height-50)}else"failed"===this.currentScreen?(t.font="14px Helvetica",t.fillText("You failed! Peruvian Web Services is in ruins.",kontra.canvas.width/2,20),t.fillText(`You lasted ${(this.endTime.getTime()-this.startTime.getTime())/1e3}s before going offline`,kontra.canvas.width/2,40),t.font="30px Helvetica",t.fillStyle="#E5DADA",t.fillText("Main Menu",kontra.canvas.width/2,kontra.canvas.height-50)):(this.blocks.forEach(t=>kontra.sprite(t).render()),this.packets.forEach(t=>kontra.sprite(t).render()),this.canRenderLogoSprite&&this.logoSprite.render(),t.font="40px Helvetica",t.fillText("Play",kontra.canvas.width/2,kontra.canvas.height-50))}}i(0),kontra.init();const c=kontra.sprite({x:0,y:0,width:kontra.canvas.width,height:kontra.canvas.height,color:"#012A36"});let l="menu";const d={menu:null,insideElement:null,dataCenter:null,failed:null};let u=0,p=null;kontra.gameLoop({update(){if(null===d[l])if("insideElement"===l)1===u&&(p=new Date),d[l]=new class{constructor(t){this.setupLevel(t),this.failed=!1,this.pointer=kontra.sprite(new n(kontra.pointer.x,kontra.pointer.y,50,5,0)),this.pointer.rotationStep=Math.PI/8,this.pointer.color="#ffae19",this.pointer.update=function(){this.x=kontra.pointer.x,this.y=kontra.pointer.y},kontra.pointer.onDown(()=>{this.blocks.length>=this.blocksLimit&&this.blocks.shift(),this.blocks.push(new n(this.pointer.x,this.pointer.y,this.pointer.width,this.pointer.height,this.pointer.rotation,50))}),document.addEventListener("wheel",t=>{t.deltaY<0?this.pointer.rotation-=this.pointer.rotationStep:t.deltaY>0&&(this.pointer.rotation+=this.pointer.rotationStep)})}update(){this.packetSpawners.forEach(t=>{t.checkSpawnPacket()&&this.packets.push(t.generatePacket())}),this.packets.forEach((t,e)=>{t.update();const{x:i,y:s}=t.checkBlockCollisions(this.blocks);i&&s&&this.effects.push(new class{constructor(t,e,i,s){this.x=t,this.y=e,this.color="red",this.radius=i,this.lifetime=s,this.finished=!1,this.render=function(){let t=this.context.createRadialGradient(this.x,this.y,this.radius/2,this.x,this.y,this.radius);t.addColorStop(0,"transparent"),t.addColorStop(.2,"#A9BCD0"),t.addColorStop(1,"#D8DBE2"),this.context.fillStyle=t,this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI),this.context.fill()}}update(){this.lifetime>0?(this.radius+=1,this.lifetime-=1):this.finished=!0}}(i,s,1,15)),t.lost&&this.packets.splice(e,1)});let t=0;return this.connections.forEach(e=>{e.update(),e.checkCollisions(this.packets),e.failed&&(this.failed=!0),e.succeeded&&t++}),this.effects.forEach((t,e)=>{t.update(),t.finished&&this.effects.splice(e,1)}),this.pointer.update(),this.failed?"failed":t===this.connections.length||this.survivedCorrectTime?"dataCenter":"insideElement"}render(){[this.packets,this.connections,this.blocks,this.effects].forEach(t=>t.forEach(t=>kontra.sprite(t).render())),this.pointer.render();const t=kontra.context;this.connections.forEach(e=>{t.fillStyle=e.color,t.fillText(`ping: ${Math.floor(e.timeSinceLastPacket/15)}`,e.x+10,e.y-5)}),t.fillStyle="#E5DADA",t.font="14px Helvetica",t.fillText(`Patch cables available: ${this.blocksLimit-this.blocks.length}`,100,20)}setupLevel(t){this.level=t,this.packets=[],this.packetSpawners=[],this.effects=[],this.connections=[],this.blocks=[],this.timeToSuccess=1e5*t,this.survivedCorrectTime=!1,setTimeout(()=>{this.survivedCorrectTime=!0},this.timeToSuccess);let e=2+Math.round(t/2);this.blocksLimit=2+2*e;for(let i=0;i<e;i++){const e=1+t/4;this.packetSpawners.push(new h(.1,kontra.canvas.width,kontra.canvas.height,e))}for(let i=0;i<e;i++){const e=20,i=20,n=150,a=500+500/t;this.connections.push(new s(Math.random()*(kontra.canvas.width-e),Math.random()*(kontra.canvas.height-i),i,e,a,n))}}}(u);else if("dataCenter"===l)d[l]=new class{constructor(t){this.level=t;const e=(kontra.canvas.width-350)/2;this.shouldChangeGameState=!1;const i=Math.round(5*Math.random()),s=t=>i===t,n=Math.max(60,200-10*t);this.dataCenterElements=[new o(e+0,150,50,50,s(0),n,"NA"),new o(e+150,150,50,50,s(1),n,"EU"),new o(e+300,150,50,50,s(2),n,"AS"),new o(e+0,300,50,50,s(3),n,"SA"),new o(e+150,300,50,50,s(4),n,"AF"),new o(e+300,300,50,50,s(5),n,"OC")],kontra.pointer.onDown(()=>{this.failedElement&&(kontra.pointer.over(kontra.sprite(this.failedElement)),this.shouldChangeGameState=!0)})}update(){return this.dataCenterElements.forEach(t=>t.update()),this.failedElement=this.dataCenterElements.find(t=>t.isFailed),this.failedElement&&setTimeout(()=>{this.shouldChangeGameState=!0},5e3),this.shouldChangeGameState?"insideElement":"dataCenter"}render(){const t=kontra.context;t.font="20px Helvetica",t.fillStyle="#E5DADA",t.textAlign="center",t.fillText("Peruvian Web Services System Overview",kontra.canvas.width/2,40),t.fillText("System status:",kontra.canvas.width/2-35,70),this.failedElement?(t.fillStyle="red",t.fillText("ERROR",kontra.canvas.width/2+80,70)):(t.fillStyle="green",t.fillText("OK",kontra.canvas.width/2+65,70)),this.dataCenterElements.forEach(t=>kontra.sprite(t).render())}}(u);else if("menu"===l)d[l]=new r("main");else if("failed"===l){l="menu",u=0;const t=new Date;d[l]=new r("failed",p,t),p=null}const t=d[l].update();t!==l&&(d[l]=null,l=t,"dataCenter"===t&&u++)},render(){c.render(),d[l]&&d[l].render()}}).start()}]);